{% extends 'base.html' %}
{% block content %}

<div class="row align-items-center g-4 mt-4">

  <!-- Product Image -->
  <div class="col-md-6">
    <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
      <img src="{{ url_for('static', filename='images/' ~ product.image) }}"
           class="img-fluid"
           alt="{{ product.name }}"
           style="height:350px; object-fit:cover;">
    </div>
  </div>

  <!-- Product Details -->
  <div class="col-md-6 d-flex flex-column justify-content-center">

    <h2 class="fw-bold mb-2">{{ product.name }}</h2>

    <p class="fs-4 text-success fw-bold mb-3">â‚¹{{ "%.2f"|format(product.price) }}</p>

    <p class="text-muted mb-4">
      Fresh, farm-picked vegetables delivered straight to your doorstep ðŸ¥•ðŸ¥¦
    </p>

    {% if current_user.is_authenticated %}

    <!-- Quantity Control -->
    <div class="quantity-control d-flex align-items-center mb-3">
      <button type="button" class="btn btn-outline-secondary btn-sm btn-minus">âˆ’</button>
      <input type="number"
             value="1"
             min="1"
             class="form-control form-control-sm mx-2 quantity-input text-center"
             style="max-width:80px;">
      <button type="button" class="btn btn-outline-secondary btn-sm btn-plus">+</button>
    </div>

    <!-- Add to Cart -->
    <form action="{{ url_for('add_to_cart', id=product.id) }}" method="POST" class="d-flex">
      <input type="hidden" name="quantity" class="cart-quantity" value="1">
      <button type="submit" class="btn btn-primary btn-lg w-100 add-to-cart">
        ðŸ›’ Add to Cart
      </button>
    </form>

    {% else %}
    <a href="{{ url_for('login') }}" class="btn btn-outline-primary mt-3 w-100">
      Buy Now
    </a>
    {% endif %}

  </div>
</div>

<!-- JS for quantity + hidden input sync -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const qtyInput = document.querySelector('.quantity-input');
  const hiddenInput = document.querySelector('.cart-quantity');
  const btnMinus = document.querySelector('.btn-minus');
  const btnPlus = document.querySelector('.btn-plus');

  if(!qtyInput || !hiddenInput) return;

  const updateHidden = () => hiddenInput.value = qtyInput.value;

  btnMinus?.addEventListener('click', () => {
    let val = parseInt(qtyInput.value) || 1;
    if(val > 1) qtyInput.value = val - 1;
    updateHidden();
  });

  btnPlus?.addEventListener('click', () => {
    let val = parseInt(qtyInput.value) || 1;
    qtyInput.value = val + 1;
    updateHidden();
  });

  qtyInput.addEventListener('input', () => {
    let val = parseInt(qtyInput.value);
    if(isNaN(val) || val < 1) val = 1;
    qtyInput.value = val;
    updateHidden();
  });

  // Optional: feedback on Add-to-Cart button
  const addBtn = document.querySelector('.add-to-cart');
  addBtn?.addEventListener('click', () => {
    const originalText = addBtn.innerHTML;
    addBtn.innerHTML = "âœ“ Added";
    addBtn.disabled = true;
    setTimeout(() => {
      addBtn.innerHTML = originalText;
      addBtn.disabled = false;
    }, 1000);
  });
});
</script>

{% endblock %}
