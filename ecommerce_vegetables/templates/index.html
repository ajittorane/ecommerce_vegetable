{% extends 'base.html' %}
{% block content %}
<!-- Custom CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<div class="container mt-5">

  <h2 class="mb-5 fw-bold text-center">
    ðŸ¥¬ Fresh Vegetables Delivered to Your Doorstep
  </h2>

  <div class="row g-4">
    {% for product in products %}
    <div class="col-lg-3 col-md-4 col-sm-6">
      <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden position-relative hover-scale">

        <!-- Product Image -->
        <img src="{{ url_for('static', filename='images/' ~ product.image) }}"
             class="card-img-top"
             alt="{{ product.name }}"
             style="height:220px; object-fit:cover; transition: transform 0.3s;">

        <!-- Availability Badge -->
        {% if product.status == 'available' %}
        <span class="badge position-absolute top-2 start-2 bg-success text-white px-3 py-1 rounded-pill">
          Available
        </span>
        {% else %}
        <span class="badge position-absolute top-2 start-2 bg-warning text-dark px-3 py-1 rounded-pill">
          Upcoming
        </span>
        {% endif %}

        <!-- Card Body -->
        <div class="card-body d-flex flex-column">

          <!-- Product Name & Price -->
          <h5 class="fw-semibold mb-1">{{ product.name }}</h5>
          <p class="text-success fw-bold mb-3">
            {% if product.status == 'available' %}
              â‚¹{{ "%.2f"|format(product.price) }}
            {% else %}
              Coming Soon
            {% endif %}
          </p>

          {% if current_user.is_authenticated %}
            {% if product.status == 'available' %}
            <!-- ADD TO CART FORM -->
            <form action="{{ url_for('add_to_cart', id=product.id) }}" method="POST" class="mt-auto">

              <!-- Quantity Controls -->
              <div class="quantity-control d-flex align-items-center justify-content-center mb-3">
                <button type="button" class="btn btn-outline-secondary btn-sm btn-minus">âˆ’</button>
                <input type="number"
                       class="form-control form-control-sm mx-2 quantity-input text-center"
                       value="1"
                       min="1"
                       style="width:60px;">
                <button type="button" class="btn btn-outline-secondary btn-sm btn-plus">+</button>
              </div>

              <!-- Hidden Quantity -->
              <input type="hidden" name="quantity" class="cart-quantity" value="1">

              <!-- Add to Cart Button -->
              <button type="submit" class="btn btn-primary w-100 add-to-cart btn-hover">
                ðŸ›’ Add to Cart
              </button>
            </form>
            {% else %}
            <!-- Coming Soon Button -->
            <button class="btn btn-secondary w-100 mt-auto" disabled>Coming Soon</button>
            {% endif %}
          {% else %}
            <!-- Login Button -->
            <a href="{{ url_for('login') }}" class="btn btn-outline-primary w-100 mt-auto">Login to Buy</a>
          {% endif %}

        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12 text-center py-5">
      <p class="text-muted fs-5">
        No products available at the moment. Check back soon! ðŸ¥¦
      </p>
      <a href="{{ url_for('index') }}" class="btn btn-primary mt-2">Shop Now</a>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Footer -->
<footer class="mt-auto text-center bg-dark text-white py-4">
  <div class="container">
    <p class="mb-2">&copy; {{ current_year }} VegStore. All Rights Reserved.</p>
    <div class="d-flex justify-content-center gap-3 mb-2">
      <a href="#"><i class="bi bi-facebook fs-5"></i></a>
      <a href="#"><i class="bi bi-twitter fs-5"></i></a>
      <a href="#"><i class="bi bi-instagram fs-5"></i></a>
    </div>
    <p class="mb-0">
      <a href="#" class="text-white text-decoration-none">Privacy Policy</a> | 
      <a href="#" class="text-white text-decoration-none">Terms of Service</a>
    </p>
  </div>
</footer>

<script src="{{ url_for('static', filename='js/script.js') }}"></script>

{% endblock %}
